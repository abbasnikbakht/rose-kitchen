{% extends "base.html" %}

{% block title %}Browse Chefs - Personal Chef Marketplace{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h1 class="display-4 fw-bold mb-4">Professional Chefs</h1>
            <p class="lead text-muted mb-5">Discover talented chefs for your in-home cooking experiences</p>
        </div>
    </div>

    <!-- Search Filters -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <form method="GET" action="{{ url_for('browse_cooks') }}">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <input type="text" class="form-control" name="location" 
                                       placeholder="Location" value="{{ request.args.get('location', '') }}">
                            </div>
                            <div class="col-md-2">
                                <select class="form-select" name="cuisine_type">
                                    <option value="">All Cuisines</option>
                                    <option value="persian" {% if request.args.get('cuisine_type') == 'persian' %}selected{% endif %}>Persian</option>
                                    <option value="italian" {% if request.args.get('cuisine_type') == 'italian' %}selected{% endif %}>Italian</option>
                                    <option value="french" {% if request.args.get('cuisine_type') == 'french' %}selected{% endif %}>French</option>
                                    <option value="asian" {% if request.args.get('cuisine_type') == 'asian' %}selected{% endif %}>Asian</option>
                                    <option value="mexican" {% if request.args.get('cuisine_type') == 'mexican' %}selected{% endif %}>Mexican</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <select class="form-select" name="min_rating">
                                    <option value="0" {% if request.args.get('min_rating', '0') == '0' %}selected{% endif %}>Any Rating</option>
                                    <option value="4" {% if request.args.get('min_rating') == '4' %}selected{% endif %}>4+ Stars</option>
                                    <option value="5" {% if request.args.get('min_rating') == '5' %}selected{% endif %}>5 Stars</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <select class="form-select" name="dietary_requirements">
                                    <option value="">Dietary Needs</option>
                                    <option value="halal" {% if request.args.get('dietary_requirements') == 'halal' %}selected{% endif %}>Halal</option>
                                    <option value="vegetarian" {% if request.args.get('dietary_requirements') == 'vegetarian' %}selected{% endif %}>Vegetarian</option>
                                    <option value="vegan" {% if request.args.get('dietary_requirements') == 'vegan' %}selected{% endif %}>Vegan</option>
                                    <option value="gluten_free" {% if request.args.get('dietary_requirements') == 'gluten_free' %}selected{% endif %}>Gluten-Free</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <button type="submit" class="btn btn-primary me-2">
                                    <i class="fas fa-search"></i> Filter
                                </button>
                                <a href="{{ url_for('browse_cooks') }}" class="btn btn-outline-secondary">
                                    <i class="fas fa-times"></i> Clear
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Count -->
    <div class="row mb-3">
        <div class="col-12">
            <p class="text-muted">
                Showing {{ cooks.items|length }} of {{ cooks.total }} chefs
                {% if request.args.get('location') or request.args.get('cuisine_type') or request.args.get('min_rating') or request.args.get('dietary_requirements') %}
                    matching your criteria
                {% endif %}
            </p>
        </div>
    </div>

    <!-- Chef Cards -->
    <div class="row g-4">
        {% for cook in cooks.items %}
        <div class="col-lg-4 col-md-6">
            <div class="card cook-card h-100 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 60px; height: 60px;">
                            {% if cook.profile_image %}
                                <img src="{{ cook.profile_image }}" alt="{{ cook.cook.first_name }}" class="rounded-circle" style="width: 60px; height: 60px; object-fit: cover;">
                            {% else %}
                                <i class="fas fa-user text-white fs-4"></i>
                            {% endif %}
                        </div>
                        <div>
                            <h5 class="card-title mb-0">{{ cook.cook.first_name }} {{ cook.cook.last_name }}</h5>
                            <small class="text-muted">{{ cook.experience_years }} years experience</small>
                            <div class="mt-1">
                                {% if cook.is_featured %}
                                    <span class="badge bg-warning text-dark me-1">‚≠ê Featured</span>
                                {% endif %}
                                {% if cook.is_verified %}
                                    <span class="badge bg-success me-1">‚úì Verified</span>
                                {% endif %}
                                {% if cook.insurance_verified %}
                                    <span class="badge bg-info me-1">üõ°Ô∏è Insured</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <p class="card-text text-muted">{{ cook.bio[:120] }}{% if cook.bio|length > 120 %}...{% endif %}</p>
                    
                    <div class="mb-3">
                        <strong>Specialties:</strong>
                        <div class="mt-1">
                            {% for specialty in cook.specialties.split('\n')[:3] %}
                                <span class="badge bg-light text-dark me-1 mb-1">{{ specialty.strip() }}</span>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="mb-3">
                        <strong>Dietary Expertise:</strong>
                        <div class="mt-1">
                            {% for dietary in cook.dietary_expertise.split('\n')[:2] %}
                                <span class="badge bg-secondary me-1 mb-1">{{ dietary.strip() }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            {% if cook.price_per_person %}
                                <span class="h5 text-primary">${{ "%.0f"|format(cook.price_per_person) }}</span>
                                <small class="text-muted">/person</small>
                            {% else %}
                                <span class="h5 text-primary">${{ "%.0f"|format(cook.hourly_rate) }}</span>
                                <small class="text-muted">/hour</small>
                            {% endif %}
                            <div class="small text-muted">
                                {{ cook.min_guests }}-{{ cook.max_guests }} guests
                            </div>
                        </div>
                        <a href="{{ url_for('cook_profile', cook_id=cook.id) }}" class="btn btn-primary">
                            View Profile
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if cooks.pages > 1 %}
    <div class="row mt-5">
        <div class="col-12">
            <nav aria-label="Chef pagination">
                <ul class="pagination justify-content-center">
                    {% if cooks.has_prev %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('browse_cooks', page=cooks.prev_num, **request.args) }}">Previous</a>
                        </li>
                    {% endif %}
                    
                    {% for page_num in cooks.iter_pages() %}
                        {% if page_num %}
                            {% if page_num != cooks.page %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('browse_cooks', page=page_num, **request.args) }}">{{ page_num }}</a>
                                </li>
                            {% else %}
                                <li class="page-item active">
                                    <span class="page-link">{{ page_num }}</span>
                                </li>
                            {% endif %}
                        {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if cooks.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('browse_cooks', page=cooks.next_num, **request.args) }}">Next</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </div>
    {% endif %}

    <!-- No Results -->
    {% if cooks.items|length == 0 %}
    <div class="row">
        <div class="col-12 text-center py-5">
            <i class="fas fa-search fa-3x text-muted mb-3"></i>
            <h3>No chefs found</h3>
            <p class="text-muted">Try adjusting your search criteria or browse all chefs.</p>
            <a href="{{ url_for('browse_cooks') }}" class="btn btn-primary">View All Chefs</a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}