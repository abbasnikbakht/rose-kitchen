{% extends "base.html" %}

{% block title %}Book {{ cook.cook.first_name }} {{ cook.cook.last_name }} - KitchenBook{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-4">
                        <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 60px; height: 60px;">
                            <i class="fas fa-user text-white"></i>
                        </div>
                        <div>
                            <h4 class="mb-0">Book {{ cook.cook.first_name }} {{ cook.cook.last_name }}</h4>
                            <p class="text-muted mb-0">${{ "%.2f"|format(cook.hourly_rate) }}/hour â€¢ {{ cook.experience_years }} years experience</p>
                        </div>
                    </div>
                    
                    <form method="POST">
                        {{ form.hidden_tag() }}
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form.event_type.label(class="form-label") }}
                                {{ form.event_type(class="form-select" + (" is-invalid" if form.event_type.errors else "")) }}
                                {% if form.event_type.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.event_type.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form.guest_count.label(class="form-label") }}
                                {{ form.guest_count(class="form-control" + (" is-invalid" if form.guest_count.errors else "")) }}
                                {% if form.guest_count.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.guest_count.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                {{ form.event_date.label(class="form-label") }}
                                {{ form.event_date(class="form-control" + (" is-invalid" if form.event_date.errors else "")) }}
                                {% if form.event_date.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.event_date.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.start_time.label(class="form-label") }}
                                {{ form.start_time(class="form-control" + (" is-invalid" if form.start_time.errors else "")) }}
                                {% if form.start_time.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.start_time.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.end_time.label(class="form-label") }}
                                {{ form.end_time(class="form-control" + (" is-invalid" if form.end_time.errors else "")) }}
                                {% if form.end_time.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.end_time.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            {{ form.special_requests.label(class="form-label") }}
                            {{ form.special_requests(class="form-control" + (" is-invalid" if form.special_requests.errors else ""), rows="4", placeholder="Any dietary restrictions, preferred cuisine, specific dishes, etc.") }}
                            {% if form.special_requests.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.special_requests.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="d-grid">
                            {{ form.submit(class="btn btn-primary btn-lg") }}
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Booking Summary -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Booking Summary</h5>
                    
                    <div class="mb-3">
                        <h6>Cook Details</h6>
                        <p class="text-muted mb-1">{{ cook.cook.first_name }} {{ cook.cook.last_name }}</p>
                        <p class="text-muted mb-0">{{ cook.experience_years }} years experience</p>
                    </div>
                    
                    <div class="mb-3">
                        <h6>Rate</h6>
                        <p class="h5 text-primary mb-0">${{ "%.2f"|format(cook.hourly_rate) }}/hour</p>
                    </div>
                    
                    <div class="mb-3">
                        <h6>Service Area</h6>
                        <p class="text-muted mb-0">{{ cook.service_radius }} miles radius</p>
                    </div>
                    
                    <div class="mb-3">
                        <h6>Specialties</h6>
                        <div>
                            {% for specialty in cook.specialties.split('\n')[:5] %}
                                <span class="badge bg-light text-dark me-1 mb-1">{{ specialty.strip() }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Note:</strong> Final cost will be calculated based on the duration of your event. You'll receive a confirmation email once the cook accepts your booking.
                    </div>
                </div>
            </div>
            
            <!-- What's Included -->
            <div class="card mt-4">
                <div class="card-body">
                    <h6>What's Included</h6>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check text-success me-2"></i>Professional cooking service</li>
                        <li><i class="fas fa-check text-success me-2"></i>All necessary cooking equipment</li>
                        <li><i class="fas fa-check text-success me-2"></i>Cleanup after service</li>
                        <li><i class="fas fa-check text-success me-2"></i>Flexible menu planning</li>
                        <li><i class="fas fa-check text-success me-2"></i>Ingredient shopping assistance</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Calculate estimated cost based on time selection
document.addEventListener('DOMContentLoaded', function() {
    const startTimeInput = document.querySelector('input[name="start_time"]');
    const endTimeInput = document.querySelector('input[name="end_time"]');
    const hourlyRate = {{ cook.hourly_rate }};
    
    function updateCostEstimate() {
        if (startTimeInput.value && endTimeInput.value) {
            const startTime = new Date('2000-01-01T' + startTimeInput.value);
            const endTime = new Date('2000-01-01T' + endTimeInput.value);
            
            if (endTime > startTime) {
                const durationHours = (endTime - startTime) / (1000 * 60 * 60);
                const estimatedCost = durationHours * hourlyRate;
                
                // Update cost display if element exists
                const costElement = document.getElementById('estimated-cost');
                if (costElement) {
                    costElement.textContent = '$' + estimatedCost.toFixed(2);
                }
            }
        }
    }
    
    startTimeInput.addEventListener('change', updateCostEstimate);
    endTimeInput.addEventListener('change', updateCostEstimate);
});
</script>
{% endblock %}
